<link rel="stylesheet" href="~/css/chat.css" asp-append-version="true">

<div id="userblock">
    <div id="inout">
        @if (User.Identity.IsAuthenticated)
        {
            <a href="~/Account/Logout">Выйти</a>
            <div id="header"></div>
        }
        else
        {
            <p><a href="~/Account/Login">Войти</a></p>
            <p><a href="~/Account/Register">Регистрация</a></p>
        }
    </div>
@if (User.IsInRole("admin"))
{
    <div id="admin-panel">
   
        <h2>Admin Panel</h2>
        <br /><div id="notifyForm">
        <form asp-action="Ban" asp-controller="Account">
            <input type="text" id="notify" name="email" />
            <button type="submit" id="notifyBtn"  >Забанить</button>
        </form>
        </div>
   
    </div>
}
</div>
<div id="chatBody">
    <div id="userNameBlock">
        <h2>Введите ник:</h2><br />
        <input id="userName" type="text" />
        <input id="loginBtn" type="button" value="Установить" />
    </div>
    <br />


    <br />
    <div id="chatroom"></div>
    <div id="inputForm">
        <textarea  id="message"></textarea>
        <div id="sendBtn">
        <input type="button"  value="Отправить" ></input>
        </div>
    </div>
</div>

<script src="~/js/signalr/dist/browser/signalr.min.js"></script>
<script>
    const hubConnection = new signalR.HubConnectionBuilder()
        .withUrl("/chat")
        .build();

    let userName = "";
    // получение сообщения от сервера
    hubConnection.on("ReceiveMessage", function (message, userName) {

        // создаем элемент <b> для имени пользователя
        let userNameElem = document.createElement("b");
        userNameElem.appendChild(document.createTextNode(userName + ": "));

        // создает элемент <p> для сообщения пользователя
        let elem = document.createElement("p");
        elem.appendChild(userNameElem);
        elem.appendChild(document.createTextNode(message));

        var firstElem = document.getElementById("chatroom").firstChild;
        document.getElementById("chatroom").insertBefore(elem, firstElem);

    });

    // установка имени пользователя
    document.getElementById("loginBtn").addEventListener("click", function (e) {
        userName = document.getElementById("userName").value;
        document.getElementById("header").innerHTML = "<h2>Привет " + userName + "</h2>";
    });
    // отправка сообщения от простого пользователя
    document.getElementById("sendBtn").addEventListener("click", function (e) {
        let message = document.getElementById("message").value;
       
        hubConnection.invoke("Send", message, userName);
        document.getElementById("message").value="";
    });
       
    hubConnection.start();
</script>